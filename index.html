<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather Caddie – Brookridge CC</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
  <header>
    <h1>Weather Caddie</h1>
    <p class="muted">Hyper-local golf weather insights</p>
  </header>

  <main>
    <!-- Personal Caddie Profile (MVP UI only) -->
    <section class="card" id="player-profile">
      <h2>Personal Caddie Profile</h2>
      <p class="muted small">Your clubs & tendencies live here. Upload a CSV or add a few quick entries. (MVP: UI only; data loads later.)</p>

      <!-- Profile picker -->
      <div class="row">
        <label for="profileSelect">Active profile</label>
        <select id="profileSelect">
          <option value="local">My Saved Profile</option>
          <option value="default">Default</option>
          <option value="new">Create New…</option>
        </select>
      </div>

      <!-- Profile name (shown when "Create New…" is selected) -->
      <div class="row" id="profileNameRow" style="display:none">
        <label for="profileName">Profile name</label>
        <input id="profileName" type="text" placeholder="e.g., Patrick – Gamer set" />
      </div>

      <hr class="divider" />

      <!-- CSV uploader (non-functional placeholder) -->
      <div class="row">
        <label for="csvClubs">Upload club data (CSV)</label>
        <input id="csvClubs" type="file" accept=".csv" />
        <p class="muted tiny">Expected columns (min): <code>club</code>, <code>carry_yards</code>. We’ll compute averages later.</p>
      </div>

      <!-- Manual quick add (non-functional placeholder) -->
      <details class="expando">
        <summary><b>Manual quick add</b> <span class="muted">(optional)</span></summary>
        <div class="grid-2">
          <div class="row">
            <label for="clubName">Club</label>
            <input id="clubName" type="text" placeholder="e.g., 7i" />
          </div>
          <div class="row">
            <label for="clubCarry">Carry avg (yds)</label>
            <input id="clubCarry" type="number" min="20" max="400" placeholder="e.g., 165" />
          </div>
          <div class="row">
            <label for="clubStd">Dispersion (± yds)</label>
            <input id="clubStd" type="number" min="0" max="40" placeholder="e.g., 7" />
          </div>
          <div class="row">
            <label>&nbsp;</label>
            <button type="button" id="addClubBtn">Add to profile</button>
          </div>
        </div>

        <!-- Quick list for visual feedback (static placeholder) -->
        <table class="table-sm" id="clubTable">
          <thead><tr><th>Club</th><th>Carry</th><th>±</th></tr></thead>
          <tbody>
            <!-- Placeholder row examples (static) -->
            <tr><td>Driver</td><td>255</td><td>±12</td></tr>
            <tr><td>7i</td><td>165</td><td>±7</td></tr>
          </tbody>
        </table>
      </details>

      <hr class="divider" />

      <!-- Summary chip (static for now) -->
      <div class="row">
        <span class="muted">Summary</span>
        <div class="pill" id="profileSummary">Profile: Default • Clubs: 2 • Units: yd</div>
      </div>

      <!-- Save / Continue (non-functional) -->
      <div class="row right">
        <button type="button" id="saveProfileBtn">Save Profile (MVP placeholder)</button>
        <button type="button" id="continueBtn">Continue to Hole Overview →</button>
      </div>
    </section>

    <!-- Weather / hole inputs -->
    <section class="card">
      <label for="hole">Hole</label>
      <select id="hole">
        <option value="">Select…</option>
        <option>1</option><option>2</option><option>3</option><option>4</option>
        <option>5</option><option>6</option><option>7</option><option>8</option>
        <option>9</option><option>10</option><option>11</option><option>12</option>
        <option>13</option><option>14</option><option>15</option><option>16</option>
        <option>17</option><option>18</option>
      </select>

      <div class="row">
        <span class="muted">Bearing:</span>
        <span id="bearingView" class="pill">—</span>
      </div>

      <label for="driver">Your driver carry (yds)</label>
      <input id="driver" type="number" inputmode="numeric" placeholder="e.g., 250" />

      <label for="iron">Your 7-iron carry (yds)</label>
      <input id="iron" type="number" inputmode="numeric" placeholder="e.g., 165" />

      <label for="when">Time</label>
      <select id="when">
        <option value="now">Now</option>
        <option value="next">Next hour</option>
      </select>

      <button id="go">Get Weather Tips</button>
    </section>

    <section class="card" id="weather">
      <h2>Current Conditions</h2>
      <div id="wx">—</div>
    </section>

    <section class="card" id="tips">
      <h2>Caddie Tips</h2>
      <div id="out">Pick a hole and press the button.</div>
    </section>

    <!-- Compass inside <main> (moved here) -->
    <section class="card" id="compass">
      <h2>Compass • Wind vs. Facing</h2>
      <p class="muted small">Tap “Enable” on iOS to grant motion/compass access.</p>
      <button id="enableCompass">Enable compass</button>

      <div class="compass-wrap">
        <div class="compass-dial" id="dial">
          <!-- tick marks -->
          <div class="tick n">N</div><div class="tick e">E</div>
          <div class="tick s">S</div><div class="tick w">W</div>
          <!-- wind-to arrow (points where the wind is blowing) -->
          <svg class="wind-arrow" id="windArrow" viewBox="0 0 100 100" aria-hidden="true">
            <polygon points="50,8 58,28 52,28 52,92 48,92 48,28 42,28"></polygon>
          </svg>
        </div>
      </div>

      <div id="compassReadout" class="muted">
        Wind out of the —, —
      </div>
    </section>

    <!-- Page-1 MVP sugar (UI only) -->
    <script>
      (async function () {
    const sel = document.getElementById('profileSelect');
    const nameRow = document.getElementById('profileNameRow');
    const summary = document.getElementById('profileSummary');
    const tblBody = document.querySelector('#clubTable tbody');

    function setSummary(profileName, clubCount) {
      const name = profileName || (sel?.value === 'default' ? 'Default' : 'My Saved Profile');
      summary.textContent = `Profile: ${name} • Clubs: ${clubCount} • Units: yd`;
    }

    function addRow(club, carry, std) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${club}</td><td>${carry}</td><td>±${std ?? '—'}</td>`;
      tblBody.appendChild(tr);
    }

    // Show/hide "Profile name" when "Create New…" is chosen
    sel?.addEventListener('change', () => {
      nameRow.style.display = (sel.value === 'new') ? '' : 'none';
      setSummary(undefined, tblBody?.rows?.length ?? 0);
    });

    // Manual quick-add (visual only, does not persist)
    document.getElementById('addClubBtn')?.addEventListener('click', () => {
      const name  = document.getElementById('clubName').value || 'Club';
      const carry = document.getElementById('clubCarry').value || '—';
      const std   = document.getElementById('clubStd').value || '—';
      addRow(name, carry, std);
      setSummary(undefined, tblBody.rows.length);
    });

    // ---- Load your JSON file: assets/data/player_profile/patrick.json ----
    try {
      const resp = await fetch('assets/data/player_profile/patrick.json', { cache: 'no-store' });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();

      // Clear any placeholder rows
      tblBody.innerHTML = '';

      // Populate from JSON
      const clubs = Array.isArray(data.clubs) ? data.clubs : [];
      clubs.forEach(c => addRow(c.club || c.name, c.carry_yards || c.average_carry || '—', c.dispersion));

      // Summary
      setSummary(data.player || data.owner || 'My Saved Profile', clubs.length);
    } catch (err) {
      // If file is missing or invalid, leave placeholders in place
      console.warn('player_profile.json not loaded:', err);
      setSummary(undefined, tblBody?.rows?.length ?? 0);
    }
  })();
    </script>
  </main>

  <footer>
    <p class="muted">Prototype for Brookridge CC, Overland Park KS</p>
  </footer>

  <script src="assets/js/app.js"></script>
</body>
</html>
